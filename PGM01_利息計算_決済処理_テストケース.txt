000000*****************************************************************
000000* テストケース仕様書（PGM001 利息計算・決済処理用）【改訂・SRC反映版】
000000*----------------------------------------------------------------*
000000* プログラムID : PGM001
000000*----------------------------------------------------------------*
000000* プログラム概要
000000*----------------------------------------------------------------*
000000* 本テストケースは、銀行ABCの預金管理システムにおける
000000* PGM001 プログラムの処理仕様が、SRC（COBOL/DB2）と
000000* 一致していることを検証するためのものである。
000000*
000000* 対象処理：
000000*   ・FUNCTION-001：利息計算処理（表示／プレビュー専用）
000000*   ・FUNCTION-002：満期決済処理（DB更新あり）
000000*
000000* 実行機能は JCL の PARM により制御される。
000000*----------------------------------------------------------------*
000000* テスト目的
000000*----------------------------------------------------------------*
000000* 1. 利息計算ロジックが SRC 定義通りに計算されること
000000* 2. 満期判定および決済処理が正しく行われること
000000* 3. SQLCODE 判定・ROLLBACK・ABEND 処理が
000000*    SRC 通りに動作すること
000000* 4. カーソル処理（OPEN / FETCH / CLOSE）が
000000*    正しく制御されていること
000000*----------------------------------------------------------------*
000000* 前提条件（SRC反映）
000000*----------------------------------------------------------------*
000000* - DB_ACCOUNT_SAVINGS
000000* - DB_ACCOUNT_BALANCE
000000* - DB_INTEREST_INFO
000000*
000000* - 対象レコード：STATUS = '1'
000000* - カーソル処理により 1件ずつ処理
000000* - SQLCODE = 0 ：正常
000000* - SQLCODE = 100：FETCH 終了（正常終了）
000000* - SQLCODE < 0 ：異常（ABEND）
000000*----------------------------------------------------------------*
000000* パラメータ仕様（JCL）
000000*----------------------------------------------------------------*
000000* PARM = '1'
000000*   → FUNCTION-001（利息計算のみ、DB更新なし）
000000*
000000* PARM = '2'
000000*   → FUNCTION-002（満期判定＋決済、DB更新あり）
000000*
000000* PARM = '3'
000000*   → FUNCTION-001 実行後、FUNCTION-002 を続行
000000*
000000* 上記以外
000000*   → INVALID PARAM メッセージ出力後 STOP RUN
000000*----------------------------------------------------------------*
000000* 共通仕様（SRC補足）
000000*----------------------------------------------------------------*
000000* ・利息計算結果は小数点以下切り捨て（または ROUND）
000000* ・経過日数 < 0 の場合は 0 に補正
000000* ・FUNCTION-002 正常終了時のみ COMMIT
000000* ・異常時は必ず ROLLBACK
000000* ・SQLCODE < 0 時は CST-ABEND-BREAKPOINT を設定
000000*----------------------------------------------------------------*
000000* 1. 正常系テストケース
000000*----------------------------------------------------------------*
000000* ケース1：FUNCTION-001 非定期預金 利息計算（プレビュー）
000000*----------------------------------------------------------------*
000000* 条件
000000*   - PARM = '1'
000000*   - STATUS = '1'
000000*   - SAVING_TYPE = 'NON-TERM'
000000*
000000* 処理内容
000000*   - カーソル OPEN
000000*   - FETCH 取得
000000*   - START_DATE ～ 処理日付までの経過日数算出
000000*   - 利率取得（DB_INTEREST_INFO）
000000*   - 利息計算
000000*
000000*     INTEREST = MONEY_ROOT × RATE × DAYS ÷ 365
000000*
000000*   - 合計金額算出
000000*
000000*     TOTAL = MONEY_ROOT + INTEREST
000000*
000000*   - 表示のみ（UPDATEなし）
000000*
000000* 期待結果
000000*   - 計算結果が SRC と一致
000000*   - COMMIT / ROLLBACK は行われない
000000*----------------------------------------------------------------*
000000* ケース2：FUNCTION-001 定期預金 利息計算（満期判定なし）
000000*----------------------------------------------------------------*
000000* 条件
000000*   - PARM = '1'
000000*   - SAVING_TYPE = 'FIXED'
000000*
000000* 処理内容
000000*   - 満期判定処理は行わない（SRC通り）
000000*   - 経過日数は実日数を使用
000000*
000000* 期待結果
000000*   - 利息計算結果が正しい
000000*   - DB更新なし
000000*----------------------------------------------------------------*
000000* ケース3：FUNCTION-002 満期決済処理
000000*----------------------------------------------------------------*
000000* 条件
000000*   - PARM = '2'
000000*   - STATUS = '1'
000000*
000000* 処理内容
000000*   - カーソル OPEN / FETCH
000000*   - 満期日判定
000000*   - 利息計算
000000*     ・満期：定期利率
000000*     ・未満期：非定期利率
000000*
000000*   - DB 更新
000000*     ・ACCOUNT_BALANCE 更新
000000*     ・ACCOUNT_SAVINGS.STATUS = '9'
000000*
000000*   - 正常終了時 COMMIT
000000*
000000* 期待結果
000000*   - 残高が正しく加算される
000000*   - ステータスが決済済になる
000000*----------------------------------------------------------------*
000000* ケース4：PARM = '3'
000000*----------------------------------------------------------------*
000000* 処理内容
000000*   - FUNCTION-001 実行（表示）
000000*   - 続けて FUNCTION-002 実行
000000*
000000* 期待結果
000000*   - 表示後、決済まで正常に完了
000000*----------------------------------------------------------------*
000000* 2. 異常系テストケース
000000*----------------------------------------------------------------*
000000* ケースA：SQLエラー（SQLCODE < 0）
000000*----------------------------------------------------------------*
000000* 条件
000000*   - SELECT / FETCH / UPDATE で SQLCODE < 0
000000*
000000* 期待結果
000000*   - CST-ABEND-BREAKPOINT 設定
000000*   - ROLLBACK 実行
000000*   - エラーログ出力
000000*   - STOP RUN
000000*----------------------------------------------------------------*
000000* ケースB：FETCH 終了（SQLCODE = 100）
000000*----------------------------------------------------------------*
000000* 条件
000000*   - FETCH 結果なし
000000*
000000* 期待結果
000000*   - 正常終了
000000*   - COMMIT 実行なし
000000*----------------------------------------------------------------*
000000* ケースC：日付不正
000000*----------------------------------------------------------------*
000000* 条件
000000*   - START_DATE > 処理日付
000000*
000000* 期待結果
000000*   - 経過日数 = 0
000000*   - 利息 = 0
000000*   - 処理継続
000000*----------------------------------------------------------------*
000000* ケースD：無効パラメータ
000000*----------------------------------------------------------------*
000000* 条件
000000*   - PARM ≠ '1','2','3'
000000*
000000* 期待結果
000000*   - INVALID PARAM 出力
000000*   - STOP RUN
000000*----------------------------------------------------------------*
000000* 備考
000000*----------------------------------------------------------------*
000000* ・本仕様は SRC（COBOL）を正とする
000000* ・テスト結果は SQLCODE／ログで確認する
000000*****************************************************************