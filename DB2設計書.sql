-- =========================================================
-- テーブル名：DB_ACCOUNT_BALANCE
-- 説明      ：口座ごとの現在残高を管理するマスタテーブル
-- 主キー    ：ACC_ID（口座ID）
-- 備考      ：このテーブルは各口座の元本や利息計算前後の残高を管理する
-- =========================================================
CREATE TABLE MYDB.DB_ACCOUNT_BALANCE (
    ACC_ID    INTEGER       NOT NULL,   -- 口座ID（ユニーク）
    BALANCE   DECIMAL(15,2) NOT NULL,   -- 現在残高（円）
    CONSTRAINT PK_ACCOUNT_BALANCE PRIMARY KEY (ACC_ID)
);
-- 初期データ登録（サンプル口座残高）
INSERT INTO MYDB.DB_ACCOUNT_BALANCE (ACC_ID, BALANCE)
SELECT 4001,  600000.00 FROM SYSIBM.SYSDUMMY1
UNION ALL
SELECT 4002,  900000.00 FROM SYSIBM.SYSDUMMY1
UNION ALL
SELECT 4003, 1200000.00 FROM SYSIBM.SYSDUMMY1
UNION ALL
SELECT 4004,  800000.00 FROM SYSIBM.SYSDUMMY1
UNION ALL
SELECT 4005, 1500000.00 FROM SYSIBM.SYSDUMMY1;
-- =========================================================
-- テーブル名：DB_INTEREST_INFO
-- 説明      ：預金種別ごとの利率マスタ
-- 主キー    ：SAVING_TYPE（預金種別）
-- 備考      ：普通預金と定期預金の利率を管理
-- =========================================================
CREATE TABLE MYDB.DB_INTEREST_INFO (
    SAVING_TYPE   CHAR(10)     NOT NULL, -- 預金種別（例：NON-TERM, FIXED-03）
    INTEREST_RATE DECIMAL(5,4) NOT NULL, -- 年利率（例：0.0080 = 0.8%）
    CONSTRAINT PK_INTEREST_INFO PRIMARY KEY (SAVING_TYPE)
);
-- 初期データ登録（利率マスタ）
INSERT INTO MYDB.DB_INTEREST_INFO (SAVING_TYPE, INTEREST_RATE)
SELECT 'NON-TERM', 0.0080 FROM SYSIBM.SYSDUMMY1
UNION ALL
SELECT 'FIXED-03', 0.0450 FROM SYSIBM.SYSDUMMY1
UNION ALL
SELECT 'FIXED-06', 0.0550 FROM SYSIBM.SYSDUMMY1
UNION ALL
SELECT 'FIXED-12', 0.0600 FROM SYSIBM.SYSDUMMY1;

-- =========================================================
-- テーブル名：DB_ACCOUNT_SAVINGS
-- 説明      ：預金契約（普通/定期）の情報を管理するテーブル
-- 主キー    ：ORDER_ID（契約ID）
-- 外部キー  ：
--   ACC_ID       → DB_ACCOUNT_BALANCE
--   SAVING_TYPE  → DB_INTEREST_INFO
-- ステータス：1=有効, 9=完了
-- =========================================================
CREATE TABLE MYDB.DB_ACCOUNT_SAVINGS (
    ORDER_ID      INTEGER       NOT NULL, -- 契約ID
    ACC_ID        INTEGER       NOT NULL, -- 口座ID
    SAVING_TYPE   CHAR(10)      NOT NULL, -- 預金種別
    START_DATE    CHAR(8)       NOT NULL, -- 開始日（YYYYMMDD）
    END_DATE      CHAR(8)       NOT NULL, -- 満期日（YYYYMMDD）
    MONEY_ROOT    DECIMAL(15,2) NOT NULL, -- 元本
    INTEREST      DECIMAL(15,2) NOT NULL, -- 計算済利息
    MONEY         DECIMAL(15,2) NOT NULL, -- 元利合計（MONEY_ROOT + INTEREST）
    STATUS        CHAR(1)       NOT NULL, -- ステータス（1:有効 / 9:完了）
    CONSTRAINT PK_ACCOUNT_SAVINGS PRIMARY KEY (ORDER_ID),
    CONSTRAINT FK_SAVINGS_ACCOUNT FOREIGN KEY (ACC_ID)        REFERENCES MYDB.DB_ACCOUNT_BALANCE  (ACC_ID),
    CONSTRAINT FK_SAVINGS_TYPE    FOREIGN KEY (SAVING_TYPE)   REFERENCES MYDB.DB_INTEREST_INFO    (SAVING_TYPE),
    CONSTRAINT CK_SAVINGS_STATUS  CHECK (STATUS IN ('1','9'))
);
-- 預金契約 初期データ登録（STATUS = '1' が処理対象）
INSERT INTO MYDB.DB_ACCOUNT_SAVINGS
(ORDER_ID, ACC_ID, SAVING_TYPE, START_DATE, END_DATE,
 MONEY_ROOT, INTEREST, MONEY, STATUS)
SELECT 41, 4001, 'NON-TERM', '20240901', '20240901',  
800000, 0.00, 0.00, '1' FROM SYSIBM.SYSDUMMY1
UNION ALL
SELECT 42, 4001, 'FIXED-06', '20240401', '20241001', 
2300000, 0.00, 0.00, '1' FROM SYSIBM.SYSDUMMY1
UNION ALL
SELECT 43, 4001, 'FIXED-12', '20240101', '20250101', 
4500000, 0.00, 0.00, '1' FROM SYSIBM.SYSDUMMY1
UNION ALL
SELECT 44, 4002, 'FIXED-03', '20240701', '20241001', 
1700000, 0.00, 0.00, '1' FROM SYSIBM.SYSDUMMY1
UNION ALL
SELECT 45, 4002, 'NON-TERM', '20240915', '20240915',  
600000, 0.00, 0.00, '1' FROM SYSIBM.SYSDUMMY1
UNION ALL
SELECT 46, 4003, 'FIXED-06', '20240501', '20241101', 
2900000, 0.00, 0.00, '1' FROM SYSIBM.SYSDUMMY1
UNION ALL
SELECT 47, 4003, 'FIXED-12', '20240201', '20250201', 
5800000, 0.00, 0.00, '1' FROM SYSIBM.SYSDUMMY1
UNION ALL
SELECT 48, 4004, 'NON-TERM', '20241005', '20241005',  
900000, 0.00, 0.00, '1' FROM SYSIBM.SYSDUMMY1
UNION ALL
SELECT 49, 4004, 'FIXED-03', '20240801', '20241101', 
1300000, 0.00, 0.00, '1' FROM SYSIBM.SYSDUMMY1
UNION ALL
SELECT 50, 4005, 'FIXED-06', '20240601', '20241201', 
3600000, 0.00, 0.00, '1' FROM SYSIBM.SYSDUMMY1
UNION ALL
SELECT 51, 4005, 'FIXED-12', '20240101', '20250101', 
6000000, 0.00, 0.00, '1' FROM SYSIBM.SYSDUMMY1
UNION ALL
SELECT 52, 4005, 'NON-TERM', '20240920', '20240920',  
700000, 0.00, 0.00, '1' FROM SYSIBM.SYSDUMMY1;
-- =========================================================
-- 確認用SELECT（処理結果確認用）
-- =========================================================
SELECT * FROM MYDB.DB_ACCOUNT_BALANCE;
SELECT * FROM MYDB.DB_INTEREST_INFO;
SELECT * FROM MYDB.DB_ACCOUNT_SAVINGS;
-- =========================================================
-- テーブル削除（テスト用）
-- =========================================================
DROP TABLE MYDB.DB_ACCOUNT_BALANCE;
DROP TABLE MYDB.DB_INTEREST_INFO;
DROP TABLE MYDB.DB_ACCOUNT_SAVINGS;
